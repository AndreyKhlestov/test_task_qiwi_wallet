# Тестовое задание - Бот для работы с QIVI кошельком
Бот разработан для:
- автоматического создания счета пользователю для оплаты (пополнения) нашего QIVI кошелька 
(по умолчанию время жизни счета 5 минут)
- регистрации и мониторинга всех платежей 
- администрирования пользователей и бота


## Команды бота: 
- /start - запуск бота 
- /admin - вход в панель админа
- /help - помощь по командам бота

Эти команды доступны в любой момент выполнения сценариев. 

С помощью команд /start и /admin можно прервать выполнения сценария и запустить главное меню пользователя и 
администратора соответственно

Команда /admin доступна только для администратора.


## Особенности
### Логирование
В боте реализовано логирование в отдельный файл для каждого уровня ошибок 
(файл записывается до 5 МБ, до 3 файлов на каждый уровень)

### Блокировка пользователей
Блокировка пользователей происходит с помощью двух способов:
- состояние пользователя (блокирует во время работы с ботом)
- сверка с id из базы данных (блокирует запуск бота)

Через состояние пользователя доступ заблокирован только для тех пользователей, 
которые уже запускали бота (есть состояние пользователя) и после этого программу с ботом не останавливали

Сверка с id из базы данных нужна для того случая, если бот был остановлен с нашей стороны 
и у всех пользователей сбросились их состояния.

### Проверка ввода баланса
Бот принимает целое и дробное число. Бот примет как число '5.25', так и '5,25'.
Пользователь должен вводить только цифры без пробелов.
Для дробных чисел есть дополнительные требования:
- должен быть только один символ '.' или ','
- дробная часть должна быть длиной не больше двух знаков


## Сценарии


### Бот имеет два сценария работы: 
1) с обычным пользователем
2) с администратором

## Работа с пользователем: 
После запуска бота (/start), выводится сообщение с inline-кнопкой с предложением пополнить баланс.
При нажатии на кнопку - бот предлагает пользователю ввести сумму для пополнения нашего QIVI кошелька.
После ввода суммы бот отправляет сообщение об успешном создании счета с двумя inline-кнопками
- первая кнопка служит ссылкой с формированным QIVI счетом для оплаты
- вторая проверяет статус оплаты (выводит сообщение о статусе)

Есть четыре статуса оплаты:
- Счет ожидает оплаты
- Оплата прошла успешно
- Счет отклонен (при закрытии счета досрочно - пока функционал закрытия счета не добавил)
- Время жизни счета истекло. Счет не оплачен (время жизни 5 мин)

Если счет ожидает оплаты, то сообщение с inline-кнопками не удаляется. 
В остальных случаях сообщение редактируется (пишется статус оплаты и удаляются inline-кнопки).
Если оплата прошла успешно, то дополнительно записывается в базу данных внесенная сумма 

После предлагается начать процедуру оплаты заново.


## Работа с администратором:
Администратору (админу) доступна панель администратора

Для удобства, при вводе команды /start, администратор сразу попадает в панель администратора.

### В панели администратора доступны следующие команды:
- Выгрузка пользователей
- Выгрузка логов 
- Изменить баланс пользователя 
- Блокировка пользователя 
- Выход из панели админа

#### Выгрузка пользователей
Бот отправляет администратору сформированный csv файл с пользователями (id, имя, баланс)

#### Выгрузка логов 
Бот отправляет администратору все файлы с логами ошибок

#### Изменить баланс пользователя 
Администратор вводит id пользователя для поиска его в базе данных. 
Если пользователь с таким id есть, то вводится нужный баланс и данные сохраняются в базе данных

#### Блокировка пользователя
Администратор вводит id пользователя для поиска его в базе данных.
Если пользователь с таким id есть, то пользователь блокируется в боте.

Администратор себя не сможет заблокировать

Если заблокированный пользователь будет взаимодействовать с ботом, 
то бот будет отвечать только одним сообщением - "Вы заблокированы"

#### Выход из панели админа
Выход в меню обычного пользователя (сценарий для пользователя)
